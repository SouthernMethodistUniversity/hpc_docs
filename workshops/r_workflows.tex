\documentclass[aspectratio=169]{beamer}
   \usetheme{metropolis}
   \setbeamertemplate{blocks}[rounded][shadow=false]
\usepackage{url}
\usepackage{hyperref}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{dcolumn}
   \newcolumntype{d}[1]{D{.}{.}{#1}}
\usepackage{graphicx}
\usepackage[justification=centering]{caption}
\usepackage{adjustbox}
\usepackage{color}
\usepackage{textpos}
\usepackage{etoolbox}
\usepackage[cache=false]{minted}
\usepackage{multimedia}

\makeatletter
\patchcmd{\beamer@sectionintoc}{\vskip1.5em}{\vskip0.5em}{}{}
\makeatother

\definecolor{smured}{rgb}{0.797,0,0.027}
\definecolor{smublue}{RGB}{48,64,116}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\definecolor{text_gray}{RGB}{46,58,62}

\setbeamercolor{progress bar}{fg=smured,bg=smublue}
\setbeamercolor{title separator}{fg=smublue}
\setbeamercolor{frametitle}{bg=smublue}

\metroset{
  numbering=fraction
}

\hypersetup{
  colorlinks=true,
  allcolors=text_gray,
  urlcolor=smured,
}

\addtobeamertemplate{frametitle}{}{
\begin{textblock*}{1cm}(\textwidth,-1.155cm)
\includegraphics[width=1cm]{figures/smu_logo.pdf}
\end{textblock*}}

\setminted{breaklines,linenos,fontsize=\scriptsize}
\setmintedinline{fontsize=auto}

\title{R Workflows on ManeFrame II (M2)}
\author{Robert Kalescky\\ HPC Applications Scientist}
\institute{
Research and Data Sciences Services\\
Office of Information Technology\\
Center for Research Computing\\
Southern Methodist University}
\date{August 31, 2021}

\begin{document}

\begin{frame}
\titlepage
\end{frame}

\begin{frame}{Outline}
\footnotesize
\tableofcontents[hideallsubsections]
\end{frame}

\input{introduction.tex}

\section{Accessing ManeFrame II (M2)}

\begin{frame}{Accessing ManeFrame II (M2)}
\begin{description}
\item[SSH]
\begin{itemize}
  \item Provides secure command line access to the login nodes.
  \item Graphical applications require X11-forwarding.
  \item Five login nodes all accessible via \mintinline{sh}{m2.smu.edu}.
  \item \href{http://faculty.smu.edu/csc/documentation/access.html}{M2 SSH Instructions}
\end{itemize}
\item[HPC Portal]
\begin{itemize}
  \item Provides web-based access to M2.
  \begin{itemize}
    \item File access
    \item Terminal access
    \item JupyterLab (Notebooks)
    \item RStudio
    \item Remote Desktops
  \end{itemize}
\end{itemize}
\item[SFTP]
\begin{itemize}
  \item Transfer files to and from M2 using an SFTP client.
  \item \href{http://faculty.smu.edu/csc/documentation/access.html}{M2 SFTP Instructions}
\end{itemize}
\end{description}
\end{frame}

\begin{frame}{ManeFrame II (M2) HPC OnDemand Web Portal}
\begin{columns}[c]
\begin{column}{0.5\textwidth}
\begin{itemize}
\item Provides an integrated single access point for HPC resources on the
ManeFrame II (M2) supercomputer
\item Accessing the Portal:
\begin{itemize}
\item Access to the HPC portal requires an existing M2 account
\item Go to \url{hpc.smu.edu}
\item Sign in using your SMU ID and SMU password
\end{itemize}
\item \href{http://faculty.smu.edu/csc/documentation/portal.html}{HPC Portal
Documentation}
\item
\href{http://faculty.smu.edu/csc/documentation/portal.html\#remote-desktop}{HPC
Portal Walkthrough Video}
\end{itemize}
\end{column}
\begin{column}{0.5\textwidth}
\includegraphics[width=\linewidth]{figures/portal.png}
\end{column}
\end{columns}
\end{frame}

\section{Slurm}

\begin{frame}{Serial R Script: \(\pi\) Monte Carlo}
\begin{listing}[H]
\inputminted{R}{examples/r_workflows/pi_monte_carlo_serial.R}
\caption{Serial algorithm to estimate the value of Pi.}
\end{listing}
\end{frame}

\begin{frame}{Parallel R Script: \(\pi\) Monte Carlo}
\begin{listing}[H]
\inputminted{R}{examples/r_workflows/pi_monte_carlo_parallel.R}
\caption{Parallel algorithm to estimate the value of Pi.}
\end{listing}
\end{frame}

\begin{frame}{Interactive Sessions}
\begin{listing}[H]
\inputminted{sh}{examples/r_workflows/01_interactive_session}
\caption{Using \mintinline{sh}{srun} to log into a compute node to run commands interactively.}
\end{listing}
\end{frame}

\begin{frame}{Using \mintinline{sh}{srun}}
\begin{listing}[H]
\inputminted{sh}{examples/r_workflows/02_srun}
\caption{Using \mintinline{sh}{srun} to run commands directly on a compute node.}
\end{listing}
\end{frame}

\begin{frame}{Using \mintinline{sh}{sbatch --wrap}}
\begin{listing}[H]
\inputminted{sh}{examples/r_workflows/03_sbatch_wrap}
\caption{Using \mintinline{sh}{sbatch --wrap} wrap a commands in an \mintinline{sh}{sbatch} script that is then submitted to the queue can run non-interactively.}
\end{listing}
\end{frame}

\begin{frame}{Using \mintinline{sh}{sbatch}}
\begin{listing}[H]
\inputminted{sh}{examples/r_workflows/04_sbatch_htc.sbatch}
\caption{Using \mintinline{sh}{sbatch} run serial computations via an \mintinline{sh}{sbatch} script.}
\end{listing}
\end{frame}

\begin{frame}{Using \mintinline{sh}{sbatch}}
\begin{listing}[H]
\inputminted{sh}{examples/r_workflows/05_sbatch_standard-mem-s.sbatch}
\caption{Using \mintinline{sh}{sbatch} run parallel computations via an \mintinline{sh}{sbatch} script.}
\end{listing}
\end{frame}

\begin{frame}{Using \mintinline{sh}{sbatch --array}}
\begin{listing}[H]
\inputminted{sh}{examples/r_workflows/06_sbatch_array.sbatch}
\caption{Using \mintinline{sh}{sbatch --array} run parallel jobs via a single \mintinline{sh}{sbatch} script.}
\end{listing}
\end{frame}

\section{Reproducibility and Environments}

\begin{frame}{Best Practices}
\begin{itemize}
\item Use Git for version control
\item Use \mintinline{sh}{renv} for package versioning
\end{itemize}
\end{frame}

\begin{frame}{GitHub}
\begin{itemize}
\item GitHub (\url{https://github.com}) is a great tool for working with Git repositories
\item Use or add your SMU email address to your GitHub account to access all GitHub Enterprise features
\end{itemize}
\end{frame}


\begin{frame}{\mintinline{sh}{renv} Basics}
\begin{description}
\item[\mintinline{R}{renv::init()}] Initialize new project-local environment with a private R library
\item[\mintinline{R}{renv::snapshot()}] Save the current state of the project library
\item[\mintinline{R}{renv::restore()}] Restore the previously saved state of the project library, e.g.\ reloading the environment on another machine
\end{description}
\end{frame}

\begin{frame}{GitHub and \mintinline{sh}{renv} Demo}
\begin{enumerate}
\item Create new Git repository on GitHub
\item Clone the new repository on M2
\item Create new RStudio project in RStudio via M2's Portal
\item Create clean package environment via \mintinline{R}{renv::init(bare = TRUE)}
\item Install custom packages, e.g. \mintinline{R}{renv::install("mcmc")}
\item Create environment snapshot via \mintinline{R}{renv::snapshot(packages="mcmc")}
\item Commit and push changes to the Git repository
\end{enumerate}

\end{frame}

\section{Additional Resources}

\begin{frame}{Additional Resources}
\begin{itemize}
\item \href{https://adv-r.hadley.nz/index.html}{Advanced R}
\item \href{https://rstudio.github.io/renv/index.html}{renv}
\item \href{https://environments.rstudio.com}{RStudio Environments}
\end{itemize}
\end{frame}

\input{conclusion.tex}

\end{document}

